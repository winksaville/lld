# RUN: yaml2obj < %p/Inputs/ret32.yaml > %t.ret32.o
# RUN: yaml2obj < %s > %t.o
# RUN: lld -flavor wasm -o %t.wasm %t.ret32.o %t.o
# RUN: obj2yaml %t.wasm | FileCheck %s

# Wasm module generated from the following C code:
# --
# int foo_import(void) { return 1 };
# int (*indirect_func)(void) = &foo;
# void _start(void) { indirect_func(); }
# --
# clang -c -target wasm32-unknown-unknown-wasm -o - | obj2yaml

!WASM
FileHeader:
  Version:         0x00000001
Sections:
  - Type:            TYPE
    Signatures:
      - Index:           0
        ReturnType:      I32
        ParamTypes:
      - Index:           1
        ReturnType:      NORESULT
        ParamTypes:
  - Type:            FUNCTION
    FunctionTypes:   [ 0, 1 ]
  - Type:            TABLE
    Tables:
      - ElemType:        ANYFUNC
        Limits:
          Initial:         0x00000001
  - Type:            MEMORY
    Memories:
      - Initial:         0x00000001
  - Type:            GLOBAL
    Globals:
      - Type:            I32
        Mutable:         false
        InitExpr:
          Opcode:          I32_CONST
          Value:           0
  - Type:            EXPORT
    Exports:
      - Name:            foo
        Kind:            FUNCTION
        Index:           0
      - Name:            _start
        Kind:            FUNCTION
        Index:           1
      - Name:            indirect_func
        Kind:            GLOBAL
        Index:           0
  - Type:            ELEM
    Segments:
      - Offset:
          Opcode:          I32_CONST
          Value:           0
        Functions:       [ 0 ]
  - Type:            CODE
    Relocations:
      - Type:            R_WEBASSEMBLY_GLOBAL_ADDR_LEB
        Index:           0
        Offset:          0x00000019
      - Type:            R_WEBASSEMBLY_TYPE_INDEX_LEB
        Index:           0
        Offset:          0x00000023
    Functions:
      - Locals:
          - Type:            I32
            Count:           1
        Body:            4101210020000F0B
      - Locals:
          - Type:            I32
            Count:           2
        Body:            4100210020002802808080800021012001118080808000001A0F0B
  - Type:            DATA
    Relocations:
      - Type:            R_WEBASSEMBLY_TABLE_INDEX_I32
        Index:           0
        Offset:          0x00000006
    Segments:
      - Index:           0
        Offset:
          Opcode:          I32_CONST
          Value:           0
        Content:         '00000000'
  - Type:            CUSTOM
    Name:            name
    FunctionNames:
      - Index:           0
        Name:            foo
      - Index:           1
        Name:            _start


# CHECK: !WASM
# CHECK: FileHeader:      
# CHECK:   Version:         0x00000001
# CHECK: Sections:        
# CHECK:   - Type:            TYPE
# CHECK:     Signatures:      
# CHECK:       - Index:           0
# CHECK:         ReturnType:      I32
# CHECK:         ParamTypes:      
# CHECK:           - F32
# CHECK:       - Index:           1
# CHECK:         ReturnType:      I32
# CHECK:         ParamTypes:      
# CHECK:       - Index:           2
# CHECK:         ReturnType:      NORESULT
# CHECK:         ParamTypes:      
# CHECK:   - Type:            FUNCTION
# CHECK:     FunctionTypes:   [ 0, 1, 2 ]
# CHECK:   - Type:            TABLE
# CHECK:     Tables:          
# CHECK:       - ElemType:        ANYFUNC
# CHECK:         Limits:          
# CHECK:           Flags:           0x00000001
# CHECK:           Initial:         0x00000001
# CHECK:           Maximum:         0x00000001
# CHECK:   - Type:            MEMORY
# CHECK:     Memories:        
# CHECK:       - Initial:         0x00000003
# CHECK:   - Type:            GLOBAL
# CHECK:     Globals:         
# CHECK:       - Type:            I32
# CHECK:         Mutable:         true
# CHECK:         InitExpr:        
# CHECK:           Opcode:          I32_CONST
# CHECK:           Value:           131072
# CHECK:   - Type:            EXPORT
# CHECK:     Exports:         
# CHECK:       - Name:            memory
# CHECK:         Kind:            MEMORY
# CHECK:         Index:           0
# CHECK:       - Name:            main
# CHECK:         Kind:            FUNCTION
# CHECK:         Index:           2
# CHECK:   - Type:            ELEM
# CHECK:     Segments:        
# CHECK:       - Offset:          
# CHECK:           Opcode:          I32_CONST
# CHECK:           Value:           0
# CHECK:         Functions:       [ 0 ]
# CHECK:   - Type:            CODE
# CHECK:     Functions:       
# CHECK:       - Locals:          
# CHECK:         Body:            4180808080000B
# CHECK:       - Locals:          
# CHECK:           - Type:            I32
# CHECK:             Count:           1
# CHECK:         Body:            4101210020000F0B
# CHECK:       - Locals:          
# CHECK:           - Type:            I32
# CHECK:             Count:           2
# CHECK:         Body:            4100210020002802808088800021012001118180808000001A0F0B
# CHECK:   - Type:            DATA
# CHECK:     Segments:        
# CHECK:       - Index:           0
# CHECK:         Offset:          
# CHECK:           Opcode:          I32_CONST
# CHECK:           Value:           131072
# CHECK:         Content:         '00000000'
# CHECK:   - Type:            CUSTOM
# CHECK:     Name:            name
# CHECK:     FunctionNames:   
# CHECK:       - Index:           0
# CHECK:         Name:            ret32
# CHECK:       - Index:           1
# CHECK:         Name:            foo
# CHECK:       - Index:           2
# CHECK:         Name:            _start
