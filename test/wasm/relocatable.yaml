# RUN: yaml2obj < %p/Inputs/hello.yaml > %t.hello.o
# RUN: yaml2obj < %s > %t.o
# RUN: lld -flavor wasm -r -o %t.wasm %t.hello.o %t.o
# RUN: obj2yaml %t.wasm | FileCheck %s

# Wasm module generated from the following C code:
# --
# int foo_import(void);
# void local_func(void) { foo_import(); }
# --
# clang -c -target wasm32-unknown-unknown-wasm -o - | obj2yaml

--- !WASM
FileHeader:
 Version:         0x00000001
Sections:
 - Type:            TYPE
   Signatures:
     - Index:           0
       ReturnType:      NORESULT
       ParamTypes:
     - Index:           1
       ReturnType:      I32
       ParamTypes:
 - Type:            IMPORT
   Imports:
     - Module:          env
       Field:           foo_import
       Kind:            FUNCTION
       SigIndex:        1
 - Type:            FUNCTION
   FunctionTypes: [ 0 ]
 - Type:            CODE
   Relocations:
     - Type: R_WEBASSEMBLY_FUNCTION_INDEX_LEB
       Index: 0
       Offset: 0x000004
   Functions:
     - Locals:
       Body:        1080808080001A0F0B
 - Type:            CUSTOM
   Name:            name
   FunctionNames:
     - Index:           0
       Name:            foo_import
     - Index:           1
       Name:            local_func
# CHECK: --- !WASM
# CHECK: FileHeader:      
# CHECK:   Version:         0x00000001
# CHECK: Sections:        
# CHECK:   - Type:            TYPE
# CHECK:     Signatures:      
# CHECK:       - Index:           0
# CHECK:         ReturnType:      NORESULT
# CHECK:         ParamTypes:      
# CHECK:       - Index:           1
# CHECK:         ReturnType:      NORESULT
# CHECK:         ParamTypes:      
# CHECK:           - I32
# CHECK:       - Index:           2
# CHECK:         ReturnType:      NORESULT
# CHECK:         ParamTypes:      
# CHECK:       - Index:           3
# CHECK:         ReturnType:      I32
# CHECK:         ParamTypes:      
# CHECK:   - Type:            IMPORT
# CHECK:     Imports:         
# CHECK:       - Module:          env
# CHECK:         Field:           puts
# CHECK:         Kind:            FUNCTION
# CHECK:         SigIndex:        1
# CHECK:       - Module:          env
# CHECK:         Field:           foo_import
# CHECK:         Kind:            FUNCTION
# CHECK:         SigIndex:        3
# CHECK:   - Type:            FUNCTION
# CHECK:     FunctionTypes:   [ 0, 2 ]
# CHECK:   - Type:            MEMORY
# CHECK:     Memories:        
# CHECK:       - Initial:         0x00000002
# CHECK:   - Type:            GLOBAL
# CHECK:     Globals:         
# CHECK:       - Type:            I32
# CHECK:         Mutable:         false
# CHECK:         InitExpr:        
# CHECK:           Opcode:          I32_CONST
# CHECK:           Value:           0
# CHECK:   - Type:            EXPORT
# CHECK:     Exports:         
# CHECK:       - Name:            hello
# CHECK:         Kind:            FUNCTION
# CHECK:         Index:           1
# CHECK:   - Type:            CODE
# CHECK:     Relocations:     
# CHECK:       - Type:            R_WEBASSEMBLY_GLOBAL_ADDR_SLEB
# CHECK:         Index:           0
# CHECK:         Offset:          0x00000006
# CHECK:       - Type:            R_WEBASSEMBLY_FUNCTION_INDEX_LEB
# CHECK:         Index:           0
# CHECK:         Offset:          0x00000010
# CHECK:       - Type:            R_WEBASSEMBLY_FUNCTION_INDEX_LEB
# CHECK:         Index:           1
# CHECK:         Offset:          0x0000001A
# CHECK:     Functions:       
# CHECK:       - Locals:          
# CHECK:           - Type:            I32
# CHECK:             Count:           1
# CHECK:       - Locals:          
# CHECK:   - Type:            DATA
# CHECK:     Segments:        
# CHECK:       - Index:           0
# CHECK:         Offset:          
# CHECK:           Opcode:          I32_CONST
# CHECK:           Value:           65536
# CHECK:         Content:         68656C6C6F0A00
# CHECK:   - Type:            CUSTOM
# CHECK:     Name:            name
# CHECK:     FunctionNames:   
# CHECK:       - Index:           0
# CHECK:         Name:            puts
# CHECK:       - Index:           1
# CHECK:         Name:            foo_import
# CHECK:       - Index:           2
# CHECK:         Name:            hello
# CHECK:       - Index:           3
# CHECK:         Name:            local_func

